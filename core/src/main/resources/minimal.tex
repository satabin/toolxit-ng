% Copyright (c) 2017 Lucas Satabin
%
% Licensed under the Apache License, Version 2.0 (the "License");
% you may not use this file except in compliance with the License.
% You may obtain a copy of the License at
%
% http://www.apache.org/licenses/LICENSE-2.0
%
% Unless required by applicable law or agreed to in writing, software
% distributed under the License is distributed on an "AS IS" BASIS,
% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
% See the License for the specific language governing permissions and
% limitations under the License.

% This is a minimal TeX format for testing purpose mainly

\catcode`\{=1%
\catcode`\}=2%
\catcode`\$=3%
\catcode`\&=4%
\catcode`\#=6%
\catcode`\^=7%
\catcode`\^^K=7%
\catcode`\_=8%
\catcode`\^^A=8%
\catcode`\^^I=10%
\chardef\active=13%
\catcode`\~=\active%
\catcode`\^^L=\active%
\outer\def^^L{\par}%

% temporarily make @ a letter
\catcode`\@=11%

\countdef\count@=255%

\count10=22%
\count16=-1%
\countdef\insc@unt=20%
\countdef\allocationnumber=21%
\countdef\m@ne=22 \m@ne=-1%

\outer\def\newcount{\alloc@0\count\countdef\insc@unt}%

\def\alloc@#1#2#3#4#5{\global\advance\count1#1 by 1
  \ch@ck#1#4#2%
  \allocationnumber=\count1#1 \global#3#5=\allocationnumber}
\def\ch@ck#1#2#3{\ifnum\count1#1<#2%
  \else\errmessage{No room for a new #3}\fi}

% make @ other again
\catcode`\@=12%
